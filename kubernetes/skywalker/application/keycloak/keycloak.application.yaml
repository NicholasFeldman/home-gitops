apiVersion: argoproj.io/v1alpha1
kind: Application

metadata:
  name: skywalker-application-keycloak
  namespace: cluster

spec:
  destination:
    namespace: application
    name: in-cluster
  project: skywalker
  source:
    chart: keycloak
    repoURL: https://charts.bitnami.com/bitnami
    targetRevision: 18.0.0
    helm:
      releaseName: keycloak
      values: |-
        proxy: edge
        # https://github.com/bitnami/charts/tree/master/bitnami/keycloak#keycloak-parameters
        auth:
          adminUser: admin
          existingSecret: keycloak
        #        extraEnvVars:
        #          - name: KEYCLOAK_PROXY_ADDRESS_FORWARDING
        #            value: "true"
        #          - name: KEYCLOAK_FRONTEND_URL
        #            value: "https://auth.feldman.tech"
        # https://github.com/bitnami/charts/tree/master/bitnami/keycloak#keycloak-deploymentstatefulset-parameters
        replicaCount: 1
        # https://github.com/bitnami/charts/tree/master/bitnami/keycloak#exposure-parameters
        service:
          type: ClusterIP
        # https://github.com/bitnami/charts/tree/master/bitnami/keycloak#database-parameters
        postgresql:
          enabled: false
        externalDatabase:
          existingSecret: keycloak-database
          existingSecretPasswordKey: password
          existingSecretHostKey: host
          existingSecretDatabaseKey: database
          existingSecretUserKey: user
