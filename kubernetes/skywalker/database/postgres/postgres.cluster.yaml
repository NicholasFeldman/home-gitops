apiVersion: postgresql.cnpg.io/v1
kind: Cluster

metadata:
  name: test-cluster

spec:
  instances: 3

  storage:
    storageClass: local-path
    size: 6Gi

  monitoring:
    enablePodMonitor: true

  enableSuperuserAccess: true

  backup:
    barmanObjectStore:
      destinationPath: "s3://feldman-skywalker-test-cluster-barman"
      s3Credentials:
        accessKeyId:
          name: postgres-s3
          key: ACCESS_KEY_ID
        secretAccessKey:
          name: postgres-s3
          key: ACCESS_SECRET_KEY

  bootstrap:
    recovery:
      source: test-cluster-backup

  externalClusters:
    - name: test-cluster-backup
      barmanObjectStore:
        destinationPath: s3://feldman-skywalker-test-cluster-barman
        s3Credentials:
          accessKeyId:
            name: postgres-s3
            key: ACCESS_KEY_ID
          secretAccessKey:
            name: postgres-s3
            key: ACCESS_SECRET_KEY
