apiVersion: argoproj.io/v1alpha1
kind: Application

metadata:
  name: kenobi-home-nextcloud
  namespace: argocd

spec:
  destination:
    namespace: home
    name: in-cluster
  project: kenobi
  source:
    chart: nextcloud
    repoURL: https://nextcloud.github.io/helm
    targetRevision: 3.1.1
    helm:
      releaseName: nextcloud
      values: |-
        nextcloud:
          host: nextcloud.feldman.tech
          existingSecret:
            enabled: true
            secretName: nextcloud
            usernameKey: nextcloud-username
            passwordKey: nextcloud-password
          configs:
          extraVolumes:
            - name: ilum-documents
              nfs:
                server: "ilum.feldman.in"
                path: "/volume1/Documents"
                readOnly: false
            - name: ilum-media
              nfs:
                server: "ilum.feldman.in"
                path: "/volume1/Media"
                readOnly: false
          extraVolumeMounts:
            - name: ilum-documents
              mountPath: "/mnt/ilum_documents"
            - name: ilum-media
              mountPath: "/mnt/ilum_media"

        persistence:
          enabled: true
          size: 16Gi

        internalDatabase:
          enabled: false
        externalDatabase:
          enabled: true
          type: postgresql
          host: postgresql.database.svc.cluster.local
          database: nextcloud
          existingSecret:
            enabled: true
            secretName: nextcloud
            usernameKey: postgres-username
            passwordKey: postgres-password
