apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: home

resources:
  - ingressroute.yaml
  - namespace.yaml
  - secrets/sealed-nextcloud.yaml
  - secrets/sealed-nextcloud-postgresql.yaml

helmCharts:
  - releaseName: mealie
    name: mealie
    version: 3.3.0
    repo: https://k8s-at-home.com/charts/
    namespace: home
    valuesInline:
      env:
        TZ: America/New_York
      image:
        tag: v0.5.5
      persistence:
        config:
          enabled: true
  - releaseName: nextcloud
    name: nextcloud
    version: 2.12.0
    repo: https://nextcloud.github.io/helm
    namespace: home
    valuesInline:
      nextcloud:
        host: https://nextcloud.feldman.tech
        existingSecret:
          enabled: true
          secretName: nextcloud
          usernameKey: nextcloud-username
          passwordKey: nextcloud-password
      internalDatabase:
        enabled: false
      externalDatabase:
        enabled: true
        type: postgresql
        host: shared-postgresql-ha-pgpool.database.svc.cluster.local
        database: nextcloud
        existingSecret:
          enabled: true
          secretName: nextcloud-postgresql
          usernameKey: username
          passwordKey: password


