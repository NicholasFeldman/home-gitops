apiVersion: argoproj.io/v1alpha1
kind: Application

metadata:
  name: kenobi-{{.Release.Namespace}}-influxdb
  namespace: argocd

spec:
  destination:
    namespace: {{.Release.Namespace}}
    name: in-cluster
  project: kenobi
  source:
    chart: influxdb
    repoURL: https://charts.bitnami.com/bitnami
    targetRevision: 4.0.0
    helm:
      releaseName: influxdb
      values: |-
        architecture: high-availability
        influxdb:
         replicaCount: 2
        relay:
          replicaCount: 2
        auth:
          existingSecret: influxdb
          admin:
            org: Feldman
            bucket: Default
        persistence:
          storageClass: longhorn-database