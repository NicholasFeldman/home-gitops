apiVersion: argoproj.io/v1alpha1
kind: Application

metadata:
  name: kenobi-{{.Release.Namespace}}-unifi-poller
  namespace: argocd

spec:
  destination:
    namespace: {{.Release.Namespace}}
    name: in-cluster
  project: kenobi
  source:
    chart: unifi-poller
    repoURL: https://k8s-at-home.com/charts/
    targetRevision: 11.0.0
    helm:
      releaseName: unifi-poller
      values: |
        env:
          TZ: America/New_York
          UP_UNIFI_DEFAULT_URL: "https://192.168.40.1"
          UP_UNIFI_DEFAULT_USER: "unifipoller"
          UP_UNIFI_DEFAULT_PASS:
            valueFrom:
              secretKeyRef:
                name: unifi-poller
                key: unifi-password
          UP_INFLUXDB_URL: http://shared-influxdb.database.svc.cluster.local:8086
          UP_INFLUXDB_DB: unifi-poller
          UP_INFLUXDB_PASS:
            valueFrom:
              secretKeyRef:
                name: unifi-poller
                key: influx-password
