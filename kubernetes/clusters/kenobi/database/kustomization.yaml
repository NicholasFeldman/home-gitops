apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: database

resources:
  - namespace.yaml
  #
  # Postgres
  #
  # - secrets/sealed-nextcloud-postgresql.yaml
  #
  # Postgres HA
  #
  - secrets/sealed-shared-postgresql-ha-pgpool.yaml
  - secrets/sealed-shared-postgresql-ha-pgpool-users.yaml
  - secrets/sealed-shared-postgresql-ha-postgresql.yaml

helmCharts:
  #
  # Postgres
  #
  - releasename: nextcloud # Nextcloud uses postgres because it creates its own database users
    name: postgresql
    version: 11.0.1
    repo: https://charts.bitnami.com/bitnami
    namespace: database
    valuesInline:
      auth:
        username: nextcloud
        database: nextcloud
        # existingSecret: nextcloud-postgresql
  #
  # Postgres HA
  #
  - releaseName: shared
    name: postgresql-ha
    version: 8.2.9
    repo: https://charts.bitnami.com/bitnami
    namespace: database
    valuesInline:
      pgpool:
        existingSecret: shared-postgresql-ha-pgpool
        customUsersSecret: shared-postgresql-ha-pgpool-users
      postgresql:
        existingSecret: shared-postgresql-ha-postgresql
