apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: database

resources:
  - namespace.yaml
  #
  # Postgres HA
  #
  - secrets/sealed-nextcloud-postgresql-ha-pgpool.yaml
  - secrets/sealed-nextcloud-postgresql-ha-postgresql.yaml

  - secrets/sealed-shared-postgresql-ha-pgpool.yaml
  - secrets/sealed-shared-postgresql-ha-pgpool-users.yaml
  - secrets/sealed-shared-postgresql-ha-postgresql.yaml

helmCharts:
  #
  # Postgres HA
  #
  - releaseName: nextcloud
    name: postgresql-ha
    version: 8.2.9
    repo: https://charts.bitnami.com/bitnami
    namespace: database
    valuesInline:
      pgpool:
        existingSecret: nextcloud-postgresql-ha-pgpool
      postgresql:
        database: nextcloud
        existingSecret: nextcloud-postgresql-ha-postgresql

  - releaseName: shared
    name: postgresql-ha
    version: 8.2.9
    repo: https://charts.bitnami.com/bitnami
    namespace: database
    valuesInline:
      pgpool:
        existingSecret: shared-postgresql-ha-pgpool
        customUsersSecret: shared-postgresql-ha-pgpool-users
      postgresql:
        existingSecret: shared-postgresql-ha-postgresql
