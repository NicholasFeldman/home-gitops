apiVersion: argoproj.io/v1alpha1
kind: Application

metadata:
  name: kenobi-{{.Release.Namespace}}-kube-prometheus-stack
  namespace: argocd

spec:
  destination:
    namespace: {{.Release.Namespace}}
    name: in-cluster
  project: kenobi
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
  source:
    chart: kube-prometheus-stack
    repoURL: https://prometheus-community.github.io/helm-charts
    targetRevision: 37.3.*
    helm:
      releaseName: kube-prometheus-stack
      values: |
        prometheusOperator:
          admissionWebhooks:
            certManager:
              enabled: true
        prometheus:
          storageSpec:
            volumeClaimTemplate:
              spec:
                accessModes: ["ReadWriteOnce"]
                resources:
                  requests:
                    storage: 20Gi
        grafana:
          enabled: false
