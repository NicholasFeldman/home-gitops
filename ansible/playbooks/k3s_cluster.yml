- hosts: k3s_cluster_rpi
  tasks:
    - set_fact: 
        k3s_server:
          node-label:
            - "NodeType=rpi"
        k3s_client:
          node-label:
            - "NodeType=rpi"
        swap_file_path: /swap.img
        swap_file_state: absent

- hosts: k3s_cluster_server
  tasks:
    - set_fact:
        k3s_control_node: true
        k3s_server:
          disable:
            - traefik
            - servicelb

- hosts: k3s_cluster_agent
  tasks:
    - set_fact:
        k3s_control_node: false

- hosts: k3s_cluster
  become: yes
  roles:
    # - role: cgroups
    - role: geerlingguy.swap
    - role: xanmanning.k3s
  vars:
    swap_file_state: absent

    k3s_become: yes
    k3s_release_version: v1.23.6+k3s1
